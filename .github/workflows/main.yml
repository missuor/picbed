name: Sync picbed static branch

on:
  push:
    branches:
      - static

jobs:
  sync:
    runs-on: ubuntu-latest

    env:
      PRIVATE_KEY: ${{ secrets.ID_RSA_FOR_CODE_SYNC_IN_GITHUB }}

    steps:
      - name: Set up SSH key
        run: |
          mkdir -p ~/.ssh/
          echo "$PRIVATE_KEY" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan github.com >> ~/.ssh/known_hosts
          
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          repository: missuor/notes.git
          ref: static
          path: notes


      - name: Sync static branch
        run: |
          cd notes
          git remote add picbed git@github.com:missuor/picbed.git
          git fetch picbed static
          git push origin picbed/static:static --force
